# æ³¨è§£ï¼ˆAnnotationï¼‰

## ç®€ä»‹

å‚è€ƒï¼šhttps://blog.csdn.net/javazejian/article/details/71860633

Javaæ³¨è§£ï¼ˆAnnotationï¼‰ä¹Ÿå«åšå…ƒæ•°æ®ï¼Œä»¥`@æ³¨è§£å`åœ¨ä»£ç ä¸­å­˜åœ¨ï¼Œå®ƒæ˜¯ä¸€ç§åœ¨æºä»£ç ä¸­æ ‡æ³¨çš„ç‰¹æ®Šæ ‡è®°ï¼Œå¯ä»¥æ ‡æ³¨æºä»£ç ä¸­çš„ç±»ã€å±æ€§ã€æ–¹æ³•ã€å‚æ•°ç­‰ä»£ç ï¼Œä¸»è¦ç”¨äºåˆ›å»ºæ–‡æ¡£ï¼Œè·Ÿè¸ªä»£ç ä¸­çš„ä¾èµ–æ€§ï¼Œç”šè‡³åœ¨æ‰§è¡ŒåŸºæœ¬ç¼–è¯‘æ—¶æ£€æŸ¥ã€‚

### ä»€ä¹ˆæ˜¯æ³¨è§£

ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ³¨è§£æ˜¯ä¸€ç§æ ‡ç­¾ï¼Œå…¶å®è´¨ä¸Šå¯ä»¥è§†ä¸ºä¸€ç§ç‰¹æ®Šçš„æ³¨é‡Šï¼Œå¦‚æœæ²¡æœ‰è§£æå®ƒçš„ä»£ç ï¼Œå®ƒå¹¶ä¸æ¯”æ™®é€šæ³¨é‡Šå¼ºã€‚

è§£æä¸€ä¸ªæ³¨è§£å¾€å¾€æœ‰ä¸¤ç§å½¢å¼ï¼š

- **ç¼–è¯‘æœŸç›´æ¥çš„æ‰«æ** ï¼šç¼–è¯‘å™¨çš„æ‰«ææŒ‡çš„æ˜¯ç¼–è¯‘å™¨åœ¨å¯¹ java ä»£ç ç¼–è¯‘å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ä¼šæ£€æµ‹åˆ°æŸä¸ªç±»æˆ–è€…æ–¹æ³•è¢«ä¸€äº›æ³¨è§£ä¿®é¥°ï¼Œè¿™æ—¶å®ƒå°±ä¼šå¯¹äºè¿™äº›æ³¨è§£è¿›è¡ŒæŸäº›å¤„ç†ã€‚è¿™ç§æƒ…å†µåªé€‚ç”¨äº JDK å†…ç½®çš„æ³¨è§£ç±»ã€‚
- **è¿è¡ŒæœŸçš„åå°„** ï¼šå¦‚æœè¦è‡ªå®šä¹‰æ³¨è§£ï¼ŒJava ç¼–è¯‘å™¨æ— æ³•è¯†åˆ«å¹¶å¤„ç†è¿™ä¸ªæ³¨è§£ï¼Œå®ƒåªèƒ½æ ¹æ®è¯¥æ³¨è§£çš„ä½œç”¨èŒƒå›´æ¥é€‰æ‹©æ˜¯å¦ç¼–è¯‘è¿›å­—èŠ‚ç æ–‡ä»¶ã€‚å¦‚æœè¦å¤„ç†æ³¨è§£ï¼Œå¿…é¡»åˆ©ç”¨åå°„æŠ€æœ¯ï¼Œè¯†åˆ«è¯¥æ³¨è§£ä»¥åŠå®ƒæ‰€æºå¸¦çš„ä¿¡æ¯ï¼Œç„¶ååšç›¸åº”çš„å¤„ç†ã€‚

### æ³¨è§£çš„ä½œç”¨

æ³¨è§£æœ‰è®¸å¤šç”¨é€”ï¼š

- ç¼–è¯‘å™¨ä¿¡æ¯ï¼šç¼–è¯‘å™¨å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥æ£€æµ‹é”™è¯¯æˆ–æŠ‘åˆ¶è­¦å‘Šã€‚
- ç¼–è¯‘æ—¶å’Œéƒ¨ç½²æ—¶çš„å¤„ç†ï¼šç¨‹åºå¯ä»¥å¤„ç†æ³¨è§£ä¿¡æ¯ä»¥ç”Ÿæˆä»£ç ï¼ŒXML æ–‡ä»¶ç­‰ã€‚
- è¿è¡Œæ—¶å¤„ç†ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶æ£€æŸ¥æŸäº›æ³¨è§£å¹¶å¤„ç†ã€‚

ä½œä¸º Java ç¨‹åºå‘˜ï¼Œå¤šå¤šå°‘å°‘éƒ½æ›¾ç»å†è¿‡è¢«å„ç§é…ç½®æ–‡ä»¶ï¼ˆxmlã€propertiesï¼‰æ”¯é…çš„ææƒ§ã€‚è¿‡å¤šçš„é…ç½®æ–‡ä»¶ä¼šä½¿å¾—é¡¹ç›®éš¾ä»¥ç»´æŠ¤ã€‚ä¸ªäººè®¤ä¸ºï¼Œä½¿ç”¨æ³¨è§£ä»¥å‡å°‘é…ç½®æ–‡ä»¶æˆ–ä»£ç ï¼Œæ˜¯æ³¨è§£æœ€å¤§çš„ç”¨å¤„ã€‚

### æ³¨è§£çš„ä»£ä»·

å‡¡äº‹æœ‰å¾—å¿…æœ‰å¤±ï¼Œæ³¨è§£æŠ€æœ¯åŒæ ·å¦‚æ­¤ã€‚ä½¿ç”¨æ³¨è§£ä¹Ÿæœ‰ä¸€å®šçš„ä»£ä»·ï¼š

- æ˜¾ç„¶ï¼Œå®ƒæ˜¯ä¸€ç§ä¾µå…¥å¼ç¼–ç¨‹ï¼Œé‚£ä¹ˆï¼Œè‡ªç„¶å°±å­˜åœ¨ç€å¢åŠ ç¨‹åºè€¦åˆåº¦çš„é—®é¢˜ã€‚
- è‡ªå®šä¹‰æ³¨è§£çš„å¤„ç†éœ€è¦åœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡åå°„æŠ€æœ¯æ¥è·å–å±æ€§ã€‚å¦‚æœæ³¨è§£æ‰€ä¿®é¥°çš„å…ƒç´ æ˜¯ç±»çš„é public æˆå‘˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åå°„è·å–ã€‚è¿™å°±è¿èƒŒäº†é¢å‘å¯¹è±¡çš„å°è£…æ€§ã€‚
- æ³¨è§£æ‰€äº§ç”Ÿçš„é—®é¢˜ï¼Œç›¸å¯¹è€Œè¨€ï¼Œæ›´éš¾ä»¥ debug æˆ–å®šä½ã€‚

ä½†æ˜¯ï¼Œæ­£æ‰€è°“ç‘•ä¸æ©ç‘œï¼Œæ³¨è§£æ‰€ä»˜å‡ºçš„ä»£ä»·ï¼Œç›¸è¾ƒäºå®ƒæä¾›çš„åŠŸèƒ½è€Œè¨€ï¼Œè¿˜æ˜¯å¯ä»¥æ¥å—çš„ã€‚

### æ³¨è§£çš„å½¢å¼

Java ä¸­ï¼Œæ³¨è§£æ˜¯ä»¥ `@` å­—ç¬¦å¼€å§‹çš„ä¿®é¥°ç¬¦ã€‚å¦‚ä¸‹ï¼š

```java
@Override
void mySuperMethod() { ... }
```

æ³¨è§£å¯ä»¥åŒ…å«å‘½åæˆ–æœªå‘½åçš„å±æ€§ï¼Œå¹¶ä¸”è¿™äº›å±æ€§æœ‰å€¼ã€‚

```java
@Author(
   name = "YAO",
   date = "2/2/2022"
)
class MyClass() { ... }
```

å¦‚æœåªæœ‰ä¸€ä¸ªåä¸º value çš„å±æ€§ï¼Œé‚£ä¹ˆåç§°å¯ä»¥çœç•¥ï¼Œå¦‚ï¼š

```java
@SuppressWarnings("unchecked")
void myMethod() { ... }
```

å¦‚æœæ³¨è§£æ²¡æœ‰å±æ€§ï¼Œåˆ™ç§°ä¸º`æ ‡è®°æ³¨è§£`ã€‚å¦‚ï¼š`@Override`ã€‚

### æ³¨è§£çš„åº”ç”¨èŒƒå›´

æ³¨è§£å¯ä»¥åº”ç”¨äºç±»ã€å­—æ®µã€æ–¹æ³•å’Œå…¶ä»–ç¨‹åºå…ƒç´ çš„å£°æ˜ã€‚

JDK8 å¼€å§‹ï¼Œæ³¨è§£çš„åº”ç”¨èŒƒå›´è¿›ä¸€æ­¥æ‰©å¤§ï¼Œä»¥ä¸‹æ˜¯æ–°çš„åº”ç”¨èŒƒå›´ï¼š

ç±»å®ä¾‹åˆå§‹åŒ–è¡¨è¾¾å¼ï¼š

```java
new @Interned MyObject();
```

ç±»å‹è½¬æ¢ï¼š

```java
myString = (@NonNull String) str;
```

å®ç°æ¥å£çš„å£°æ˜ï¼š

```java
class UnmodifiableList<T> implements
    @Readonly List<@Readonly T> {}
```

æŠ›å‡ºå¼‚å¸¸å£°æ˜ï¼š

```java
void monitorTemperature()
    throws @Critical TemperatureException {}
```

## é¢„å®šä¹‰çš„æ³¨è§£

Javaåœ¨java.langåŒ…ä¸­å®šä¹‰äº†äº”ç§æ³¨è§£ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

-   `@Override`
-   `@Deprecated`
-   `@SuppressWarnnings`
-   `@SafeVarargs`
-   `@FunctionalInterface`

åœ¨Javaä¸­ï¼Œæ³¨è§£æ˜¯è¢«å½“ä½œä¸€ä¸ªä¿®é¥°ç¬¦æ¥ä½¿ç”¨çš„ï¼Œåœ¨æ³¨è§£çš„åç§°å‰é¢åŠ ä¸Š@ç¬¦å·ï¼Œæ”¾ç½®åœ¨æ³¨è§£é¡¹ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰ä¹‹å‰ï¼Œä¸­é—´æ²¡æœ‰åˆ†å·ã€‚

### @Override

Overrideæ³¨è§£è¡¨ç¤ºå½“å‰æ–¹æ³•é‡å†™äº†çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•ï¼Œæˆ–è€…å®ç°äº†æ¥å£ä¸­çš„æŸä¸ªæ–¹æ³•ï¼Œå¦‚æœçˆ¶ç±»æˆ–æ¥å£ä¸­çš„å¯¹åº”çš„æ–¹æ³•å¹¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿç¼–è¯‘é”™è¯¯ã€‚è¿™ä¸ªæ³¨è§£ä¸»è¦åœ¨è¦†ç›–æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨ï¼Œä»¥é˜²æ­¢åœ¨é‡å†™æ–¹æ³•æ—¶å‡ºé”™ã€‚

å¦‚æœè¯•å›¾ä½¿ç”¨ `@Override` æ ‡è®°ä¸€ä¸ªå®é™…ä¸Šå¹¶æ²¡æœ‰è¦†å†™çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œjava ç¼–è¯‘å™¨ä¼šå‘Šè­¦ã€‚

ã€ç¤ºä¾‹ã€‘Overrideæ³¨è§£çš„ç”¨æ³•ï¼š

```
class Base {
    public void desc(int val) {
    }

    public void desc(String val) {
    }
}

class Derived extends Base {
    @Override
    public void desc(int val) {
    }

    @Override
    public void desc(double val) {
    } //ç¼–è¯‘æŠ¥é”™ï¼Œæœªæ­£ç¡®è¦†ç›–æ–¹æ³•

}
```

Derivedç±»ä¸­çš„ç¬¬ä¸€ä¸ªdescæ–¹æ³•æ­£ç¡®è¦†ç›–äº†åŸºç±»çš„æ–¹æ³•ï¼Œè€Œç¬¬äºŒä¸ªdescæ–¹æ³•ç”±äºç–å¿½å¤§æ„ï¼Œå°†å‚æ•°ç±»å‹å†™æˆäº†doubleï¼Œåœ¨åŸºç±»ä¸­æ²¡æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚

ä½¿ç”¨Overrideæ³¨è§£åœ¨ç¼–è¯‘æ—¶å°±ä¼šå‘ç°è¿™ä¸ªé”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
Main.java:16: é”™è¯¯: æ–¹æ³•ä¸ä¼šè¦†ç›–æˆ–å®ç°è¶…ç±»å‹çš„æ–¹æ³•
    @Override 
    ^
1 ä¸ªé”™è¯¯      
é”™è¯¯: ç¼–è¯‘å¤±è´¥
```

### @Deprecated

Deprecatedæ³¨è§£è¡¨ç¤ºè¢«æ³¨è§£çš„ç¨‹åºå…ƒç´ å·²å¼ƒç”¨ï¼Œä¸åº”è¯¥å†ä½¿ç”¨ã€‚ä¸€ä¸ªç¨‹åºå…ƒç´ å¯èƒ½å› ä¸ºä»¥ä¸‹å‡ ç§åŸå› è€Œè¢«æ ‡è®°ä¸ºå·²å¼ƒç”¨ï¼š

-   å®ƒçš„ä½¿ç”¨å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ï¼›
-   å®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ä¸å…¼å®¹ï¼›
-   å®ƒå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«åˆ é™¤ï¼›
-   å®ƒè¢«ä¸€ä¸ªæ›´æ–°çš„ã€æ›´é€‚åˆçš„æ–¹æ¡ˆæ‰€å–ä»£ï¼›
-   å®ƒå·²è¿‡æ—¶ã€‚

Java 9ä¸ºè¯¥æ³¨è§£æ–°å¢äº†ä¸¤ä¸ªå…ƒç´ ï¼šsinceå’ŒforRemovalã€‚sinceå…ƒç´ çš„ç±»å‹æ˜¯Stringï¼Œè¯¥å…ƒç´ çš„å€¼æŒ‡ç¤ºè¢«æ³¨è§£çš„ç¨‹åºå…ƒç´ ç¬¬ä¸€æ¬¡è¢«å¼ƒç”¨çš„ç‰ˆæœ¬ã€‚forRemovalå…ƒç´ çš„ç±»å‹æ˜¯booleanï¼Œå€¼ä¸ºtrueè¡¨ç¤ºæ‰“ç®—åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­åˆ é™¤è¢«æ³¨è§£çš„ç¨‹åºå…ƒç´ ï¼Œå€¼ä¸ºfalseè¡¨ç¤ºä¸é¼“åŠ±ä½¿ç”¨è¢«æ³¨è§£çš„ç¨‹åºå…ƒç´ ï¼Œä½†åœ¨å¯¹ç¨‹åºå…ƒç´ è¿›è¡Œæ³¨è§£æ—¶ï¼Œè¿˜æ²¡æœ‰æ˜ç¡®çš„æ„å›¾åˆ é™¤å®ƒã€‚

å¦‚æœåœ¨ç¨‹åºä¸­ä½¿ç”¨äº†å¸¦æœ‰Deprecatedæ³¨è§£çš„æ–¹æ³•ã€ç±»ã€å­—æ®µç­‰ï¼Œç¼–è¯‘å™¨å°±ä¼šç”Ÿæˆè­¦å‘Šã€‚

`@Deprecated` æœ‰ä¸€å®šçš„å»¶ç»­æ€§ï¼šå¦‚æœæˆ‘ä»¬åœ¨ä»£ç ä¸­é€šè¿‡ç»§æ‰¿æˆ–è€…è¦†ç›–çš„æ–¹å¼ä½¿ç”¨äº†è¿‡æ—¶çš„ç±»æˆ–ç±»æˆå‘˜ï¼Œå³ä½¿å­ç±»æˆ–å­æ–¹æ³•æ²¡æœ‰æ ‡è®°ä¸º `@Deprecated`ï¼Œä½†ç¼–è¯‘å™¨ä»ç„¶ä¼šå‘Šè­¦ã€‚

æ³¨æ„ï¼š `@Deprecated` è¿™ä¸ªæ³¨è§£ç±»å‹å’Œ javadoc ä¸­çš„ `@deprecated` è¿™ä¸ª tag æ˜¯æœ‰åŒºåˆ«çš„ï¼šå‰è€…æ˜¯ java ç¼–è¯‘å™¨è¯†åˆ«çš„ï¼›è€Œåè€…æ˜¯è¢« javadoc å·¥å…·æ‰€è¯†åˆ«ç”¨æ¥ç”Ÿæˆæ–‡æ¡£ï¼ˆåŒ…å«ç¨‹åºæˆå‘˜ä¸ºä»€ä¹ˆå·²ç»è¿‡æ—¶ã€å®ƒåº”å½“å¦‚ä½•è¢«ç¦æ­¢æˆ–è€…æ›¿ä»£çš„æè¿°ï¼‰ã€‚

ã€ç¤ºä¾‹ã€‘Deprecatedæ³¨è§£çš„ç”¨æ³•

```
class A {
    @Deprecated
    public void fn() {
    }
}

@Deprecated
interface B {

}

@SuppressWarnings("deprecation")
class C implements B {
}

public class DeprecatedAnnotation {
    @SuppressWarnings("deprecation")
    public static void main(String[] args) {
        A a = new A();
        a.fn();
    }
}
```

åœ¨ç¼–è¯‘ç¨‹åºæ—¶ï¼Œä¼šå‡ºç°å¦‚ä¸‹æ‰€ç¤ºçš„è­¦å‘Šä¿¡æ¯ã€‚

```
æ³¨: DeprecatedAnnotation.javaä½¿ç”¨æˆ–è¦†ç›–äº†å·²è¿‡æ—¶çš„ APIã€‚
æ³¨: æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·ä½¿ç”¨ -Xlint:deprecation é‡æ–°ç¼–è¯‘ã€‚
é”™è¯¯: åœ¨ç±» A ä¸­æ‰¾ä¸åˆ° main(String[]) æ–¹æ³•
```

å¯ä»¥æ ¹æ®æç¤ºï¼Œä½¿ç”¨â€œ-Xlint:deprecationâ€é€‰é¡¹é‡æ–°ç¼–è¯‘ç¨‹åºï¼Œçœ‹åˆ°æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```
DeprecatedAnnotation.java:10: è­¦å‘Š: [deprecation] æœªå‘½åç¨‹åºåŒ…ä¸­çš„Bå·²è¿‡æ—¶
class C implements B{}
                   ^
DeprecatedAnnotation.java:15: è­¦å‘Š: [deprecation] Aä¸­çš„fn()å·²è¿‡æ—¶
        a.fn();
         ^
2 ä¸ªè­¦å‘Š
```

è¦æ³¨æ„ï¼Œè­¦å‘Šå¹¶ä¸æ˜¯é”™è¯¯ï¼Œæ‰€ä»¥ç¨‹åºä¾ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œã€‚éšç€Javaç‰ˆæœ¬çš„æ›´æ–°ï¼Œæœ‰äº›APIä¼šè¢«æ ‡è®°ä¸ºDeprecatedï¼Œå¦‚æœä½ ä½¿ç”¨äº†è¿™äº›APIï¼Œç¼–è¯‘å™¨å°±ä¼šæç¤ºä¸ä¸Šè¿°ç±»ä¼¼çš„è­¦å‘Šä¿¡æ¯ï¼Œä½ å¯ä»¥æ ¹æ®APIæ–‡æ¡£çš„è¯´æ˜ä½¿ç”¨æ–°çš„æ›¿æ¢APIï¼Œä¹Ÿå¯ä»¥æ— è§†è­¦å‘Šï¼ˆå‰ææ˜¯è¯¥APIåœ¨æ–°ç‰ˆæœ¬ä¸­æœªè¢«åˆ é™¤ï¼‰ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜¯åŸºäºæ–°ç‰ˆæœ¬Javaå¼€å‘æ–°çš„ç¨‹åºï¼Œé‚£ä¹ˆè¿˜æ˜¯å°½é‡ä¸è¦å»ä½¿ç”¨è¢«æ ‡è®°ä¸ºåºŸå¼ƒçš„APIã€‚

### @SuppressWarnings

SuppressWarningsæ³¨è§£ç”¨äºå…³é—­æŒ‡å®šçš„ä¸€ç±»ç¼–è¯‘å™¨è­¦å‘Šã€‚ä¾‹å¦‚ï¼Œä½ ä½¿ç”¨äº†è¢«æ ‡è®°ä¸ºåºŸå¼ƒçš„APIï¼Œä½†åˆä¸æƒ³çœ‹åˆ°è­¦å‘Šä¿¡æ¯ï¼Œå°±å¯ä»¥ä½¿ç”¨@SuppressWarningsï¼ˆ"deprecation"ï¼‰æ¥å‘ŠçŸ¥ç¼–è¯‘å™¨ä¸è¦äº§ç”Ÿè¿™ç±»è­¦å‘Šã€‚

@SuppressWarningsç”¨äºå…³é—­å¯¹ç±»ã€æ–¹æ³•ã€æˆå‘˜ç¼–è¯‘æ—¶äº§ç”Ÿçš„ç‰¹å®šè­¦å‘Šã€‚

`@SuppressWarnings` æ³¨è§£çš„å¸¸è§å‚æ•°å€¼çš„ç®€å•è¯´æ˜ï¼š

- `deprecation` - ä½¿ç”¨äº†ä¸èµæˆä½¿ç”¨çš„ç±»æˆ–æ–¹æ³•æ—¶çš„è­¦å‘Šï¼›
- `unchecked` - æ‰§è¡Œäº†æœªæ£€æŸ¥çš„è½¬æ¢æ—¶çš„è­¦å‘Šï¼Œä¾‹å¦‚å½“ä½¿ç”¨é›†åˆæ—¶æ²¡æœ‰ç”¨æ³›å‹ (Generics) æ¥æŒ‡å®šé›†åˆä¿å­˜çš„ç±»å‹;
- `fallthrough` - å½“ Switch ç¨‹åºå—ç›´æ¥é€šå¾€ä¸‹ä¸€ç§æƒ…å†µè€Œæ²¡æœ‰ Break æ—¶çš„è­¦å‘Š;
- `path` - åœ¨ç±»è·¯å¾„ã€æºæ–‡ä»¶è·¯å¾„ç­‰ä¸­æœ‰ä¸å­˜åœ¨çš„è·¯å¾„æ—¶çš„è­¦å‘Š;
- `serial` - å½“åœ¨å¯åºåˆ—åŒ–çš„ç±»ä¸Šç¼ºå°‘ serialVersionUID å®šä¹‰æ—¶çš„è­¦å‘Š;
- `finally` - ä»»ä½• finally å­å¥ä¸èƒ½æ­£å¸¸å®Œæˆæ—¶çš„è­¦å‘Š;
- `all` - æ‰€æœ‰çš„è­¦å‘Šã€‚

`@SuppressWarning` ä¸æ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ã€‚å®ƒæœ‰ä¸€ä¸ªç±»å‹ä¸º `String[]` çš„æ•°ç»„æˆå‘˜ï¼Œè¿™ä¸ªæ•°ç»„ä¸­å­˜å‚¨çš„æ˜¯è¦å…³é—­çš„å‘Šè­¦ç±»å‹ã€‚å¯¹äº javac ç¼–è¯‘å™¨æ¥è®²ï¼Œå¯¹ `-Xlint` é€‰é¡¹æœ‰æ•ˆçš„è­¦å‘Šåä¹ŸåŒæ ·å¯¹ `@SuppressWarings` æœ‰æ•ˆï¼ŒåŒæ—¶ç¼–è¯‘å™¨ä¼šå¿½ç•¥æ‰æ— æ³•è¯†åˆ«çš„è­¦å‘Šåã€‚

ç¤ºä¾‹ï¼š

```
@SuppressWarnings({"uncheck", "deprecation"})
public class InternalAnnotationDemo {

    /**
     * @SuppressWarnings æ ‡è®°æ¶ˆé™¤å½“å‰ç±»çš„å‘Šè­¦ä¿¡æ¯
     */
    @SuppressWarnings({"deprecation"})
    static class A {
        public void method1() {
            System.out.println("call method1");
        }

        /**
         * @Deprecated æ ‡è®°å½“å‰æ–¹æ³•ä¸ºåºŸå¼ƒæ–¹æ³•ï¼Œä¸å»ºè®®ä½¿ç”¨
         */
        @Deprecated
        public void method2() {
            System.out.println("call method2");
        }
    }

    /**
     * @Deprecated æ ‡è®°å½“å‰ç±»ä¸ºåºŸå¼ƒç±»ï¼Œä¸å»ºè®®ä½¿ç”¨
     */
    @Deprecated
    static class B extends A {
        /**
         * @Override æ ‡è®°æ˜¾ç¤ºæŒ‡æ˜å½“å‰æ–¹æ³•è¦†å†™äº†çˆ¶ç±»æˆ–æ¥å£çš„æ–¹æ³•
         */
        @Override
        public void method1() { }
    }

    public static void main(String[] args) {
        A obj = new B();
        obj.method1();
        obj.method2();
    }
}
```

è¿™æ—¶å€™å†ç¼–è¯‘ï¼Œå°±ä¸ä¼šå‡ºç°ä»»ä½•çš„è­¦å‘Šä¿¡æ¯äº†ã€‚

```
é”™è¯¯: åœ¨ç±» A ä¸­æ‰¾ä¸åˆ° main(String[]) æ–¹æ³•
```

è¿˜æœ‰ä¸€ç±»è­¦å‘Šä¿¡æ¯å¾ˆå¸¸è§ï¼šåœ¨ä½¿ç”¨æ³›å‹ç±»æˆ–æ¥å£çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨å‚æ•°åŒ–ç±»å‹ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥å‘Šuncheckedè­¦å‘Šã€‚å¦‚æœä¸æƒ³çœ‹åˆ°è¿™äº›è­¦å‘Šä¿¡æ¯ï¼Œåˆ™å¯ä»¥å‘SuppressWarningsæ³¨è§£ä¼ é€’unckeckedå‚æ•°å€¼ï¼Œæ¥ç¦æ­¢è¿™ä¸€ç±»è­¦å‘Šä¿¡æ¯çš„ç”Ÿæˆã€‚

### @SafeVarargs

åœ¨å£°æ˜å…·æœ‰æ¨¡ç³Šç±»å‹ï¼ˆä¾‹å¦‚æ³›å‹ï¼‰çš„å¯å˜å‚æ•°ï¼ˆå˜é•¿å‚æ•°ï¼‰çš„æ„é€ æ–¹æ³•æˆ–æ–¹æ³•æ—¶ï¼ŒJavaç¼–è¯‘å™¨ä¼šæŠ¥uncheckedè­¦å‘Šã€‚å¦‚æœç¨‹åºå‘˜æ–­å®šå£°æ˜çš„æ„é€ æ–¹æ³•æˆ–æ–¹æ³•çš„ä»£ç ä¸ä¼šå¯¹å¯å˜å‚æ•°æ‰§è¡Œæ½œåœ¨çš„ä¸å®‰å…¨æ“ä½œï¼Œåˆ™å¯ä½¿ç”¨SafeVarargsæ³¨è§£è¿›è¡Œæ ‡è®°ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¸ä¼šå†æŠ¥uncheckedè­¦å‘Šäº†ã€‚

ç®€å•çš„è¯´ï¼Œæ•°ç»„å…ƒç´ çš„æ•°æ®ç±»å‹åœ¨ç¼–è¯‘å’Œè¿è¡Œæ—¶éƒ½æ˜¯ç¡®å®šçš„ï¼Œè€Œæ³›å‹çš„æ•°æ®ç±»å‹åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šä¸‹æ¥ã€‚å› æ­¤ï¼Œå½“æŠŠä¸€ä¸ªæ³›å‹å­˜å‚¨åˆ°æ•°ç»„ä¸­æ—¶ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µæ— æ³•ç¡®è®¤æ•°æ®ç±»å‹æ˜¯å¦åŒ¹é…ï¼Œå› æ­¤ä¼šç»™å‡ºè­¦å‘Šä¿¡æ¯ï¼›å³å¦‚æœæ³›å‹çš„çœŸå®æ•°æ®ç±»å‹æ— æ³•å’Œå‚æ•°æ•°ç»„çš„ç±»å‹åŒ¹é…ï¼Œä¼šå¯¼è‡´ `ClassCastException` å¼‚å¸¸ã€‚

è¯¥æ³¨è§£åªèƒ½ç”¨äºæ„é€ æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€é™æ€æ–¹æ³•å’Œfinalæ–¹æ³•ã€‚Javaä¸­å…·æœ‰å¯å˜å‚æ•°çš„æ³›å‹æ–¹æ³•éƒ½ä½¿ç”¨äº†SafeVarargsæ³¨è§£ï¼Œä¾‹å¦‚Arraysç±»ä¸­çš„asListé™æ€æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
@SafeVarargs
@SuppressWarnings("varargs")
public static <T> List<T> asList(T... a) {
	return new ArrayList<>(a);
}
```

ã€ç¤ºä¾‹ã€‘SafeVarargsæ³¨è§£çš„ç”¨æ³•ï¼š

```
public class SafeVarargsAnnotation<T>{
    private T[] array;
    //æ„é€ æ–¹æ³•å¯ä»¥ä½¿ç”¨@SafeVarargsæ³¨è§£
    @SafeVarargs
    public SafeVarargsAnnotation(T... varArgs){
        this.array = varArgs;
    }

    // forEachæ–¹æ³•ä¸èƒ½ä½¿ç”¨@SafeVararg
    // å¦‚æœè¦å…³é—­uncheckedè­¦å‘Šï¼Œå¯ä»¥ä½¿ç”¨@SuppressWarnings æ³¨è§£
    @SuppressWarnings("unchecked")
    public void forEach(T... varArgs){
        for (T arg : varArgs) {
            System.out.println(arg);
        }
    }

    // finalæ–¹æ³•å¯ä»¥ä½¿ç”¨@SafeVarargsæ³¨è§£
    @SafeVarargs
    public final void fanalForEach(T... varArgs){
        for (T arg : varArgs) {
            System.out.println(arg);
        }
    }

    // ç§æœ‰æ–¹æ³•å¯ä»¥ä½¿ç”¨@SafeVarargsæ³¨è§£
    @SafeVarargs
    private void privateForEach(T... varArgs){
        for (T arg : varArgs) {
            System.out.println(arg);
        }
    }
   
    // é™æ€æ–¹æ³•å¯ä»¥ä½¿ç”¨@SafeVarargsæ³¨è§£
    @SafeVarargs
    public static <T> void staticForEach(T... varArgs){
        for (T arg : varArgs) {
            System.out.println(arg);
        }
    }
}
```

### @FunctionalInterface

`@FunctionalInterface`ç”¨äºæŒ‡ç¤ºè¢«ä¿®é¥°çš„æ¥å£æ˜¯å‡½æ•°å¼æ¥å£ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ¥å£ç¬¦åˆ"å‡½æ•°å¼æ¥å£"å®šä¹‰ï¼Œä¸åŠ  `@FunctionalInterface` ä¹Ÿæ²¡å…³ç³»ï¼›ä½†å¦‚æœç¼–å†™çš„ä¸æ˜¯å‡½æ•°å¼æ¥å£ï¼Œå´ä½¿ç”¨`@FunctionInterface`ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚

ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£ï¼Ÿ

**å‡½æ•°å¼æ¥å£(Functional Interface)å°±æ˜¯ä¸€ä¸ªæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªéæŠ½è±¡æ–¹æ³•çš„æ¥å£**ã€‚å‡½æ•°å¼æ¥å£å¯ä»¥è¢«éšå¼è½¬æ¢ä¸º lambda è¡¨è¾¾å¼ã€‚

å‡½æ•°å¼æ¥å£çš„ç‰¹ç‚¹ï¼š

- æ¥å£æœ‰ä¸”åªèƒ½æœ‰ä¸ªä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ˆæŠ½è±¡æ–¹æ³•åªæœ‰æ–¹æ³•å®šä¹‰ï¼Œæ²¡æœ‰æ–¹æ³•ä½“ï¼‰ã€‚
- ä¸èƒ½åœ¨æ¥å£ä¸­è¦†å†™ Object ç±»ä¸­çš„ public æ–¹æ³•ï¼ˆå†™äº†ç¼–è¯‘å™¨ä¹Ÿä¼šæŠ¥é”™ï¼‰ã€‚
- å…è®¸æœ‰ default å®ç°æ–¹æ³•ã€‚

ç¤ºä¾‹ï¼š

```java
public class FunctionalInterfaceAnnotationDemo {

    @FunctionalInterface
    public interface Func1<T> {
        void printMessage(T message);
    }

    /**
     * @FunctionalInterface ä¿®é¥°çš„æ¥å£ä¸­å®šä¹‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç¼–è¯‘æ—¶ä¼šæŠ¥é”™
     * @param <T>
     */
    /*@FunctionalInterface
    public interface Func2<T> {
        void printMessage(T message);
        void printMessage2(T message);
    }*/

    public static void main(String[] args) {
        Func1 func1 = message -> System.out.println(message);
        func1.printMessage("Hello");
        func1.printMessage(100);
    }
}
```

## è‡ªå®šä¹‰æ³¨è§£

æ³¨è§£æ˜¯ä¸€ç§ç±»å‹ï¼Œå®šä¹‰æ³¨è§£ä¸å®šä¹‰æ¥å£ç±»ä¼¼ï¼Œé€šè¿‡ä½¿ç”¨@interfaceå…³é”®å­—è¿›è¡Œå®šä¹‰ã€‚åœ¨å®šä¹‰æ³¨è§£æ—¶ï¼Œä¸èƒ½ç»§æ‰¿å…¶ä»–çš„æ³¨è§£æˆ–æ¥å£ã€‚`@interface` ç”¨æ¥å£°æ˜ä¸€ä¸ªæ³¨è§£ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªæ–¹æ³•å®é™…ä¸Šæ˜¯å£°æ˜äº†ä¸€ä¸ªé…ç½®å‚æ•°ã€‚æ–¹æ³•çš„åç§°å°±æ˜¯å‚æ•°çš„åç§°ï¼Œè¿”å›å€¼ç±»å‹å°±æ˜¯å‚æ•°çš„ç±»å‹ï¼ˆè¿”å›å€¼ç±»å‹åªèƒ½æ˜¯åŸºæœ¬ç±»å‹ã€Classã€Stringã€enumï¼‰ã€‚å¯ä»¥é€šè¿‡ `default` æ¥å£°æ˜å‚æ•°çš„é»˜è®¤å€¼ã€‚

è¿™é‡Œï¼Œæˆ‘ä¼šé€šè¿‡å®ç°ä¸€ä¸ªåä¸º `RegexValid` çš„æ­£åˆ™æ ¡éªŒæ³¨è§£å·¥å…·æ¥å±•ç¤ºè‡ªå®šä¹‰æ³¨è§£çš„å…¨æ­¥éª¤ã€‚

### æ³¨è§£çš„å®šä¹‰

æ³¨è§£çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š

```java
public @interface æ³¨è§£å {å®šä¹‰ä½“}
```

æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼š

```java
@Documented
@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
public @interface RegexValid {}
```

> è¯´æ˜ï¼š
>
> é€šè¿‡ä¸Šä¸€èŠ‚å¯¹äºå…ƒæ³¨è§£ [`@Target`](#target)ã€[`@Retention`](#retention)ã€[`@Documented`](#documented) çš„è¯´æ˜ï¼Œè¿™é‡Œå°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚
>
> - ä¸Šé¢çš„ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º `@RegexValid` çš„æ³¨è§£ã€‚
> - `@Documented` è¡¨ç¤º `@RegexValid` åº”è¯¥ä½¿ç”¨ javadocã€‚
> - `@Target({ElementType.FIELD, ElementType.PARAMETER})` è¡¨ç¤º `@RegexValid` å¯ä»¥åœ¨ç±»æˆå‘˜æˆ–æ–¹æ³•å‚æ•°ä¸Šä¿®é¥°ã€‚
> - @Retention(RetentionPolicy.RUNTIME) è¡¨ç¤º `@RegexValid` åœ¨è¿è¡Œæ—¶æœ‰æ•ˆã€‚

æˆ‘ä»¬å®šä¹‰çš„æ³¨è§£ç±»å‹ä¼šè‡ªåŠ¨ç»§æ‰¿è‡ªjava.lang.annotation.Annotationæ¥å£ã€‚

æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å±æ€§çš„æ³¨è§£ï¼Œå¦‚æœåˆ°æ­¤ä¸ºæ­¢ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ã€‚ä½œä¸ºæ­£åˆ™å·¥å…·ï¼Œæ²¡æœ‰å±æ€§å¯ä»€ä¹ˆä¹Ÿåšä¸äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸ºå®ƒæ·»åŠ æ³¨è§£å±æ€§ã€‚

### æ³¨è§£å±æ€§

æ³¨è§£å±æ€§çš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š

```
[è®¿é—®çº§åˆ«ä¿®é¥°ç¬¦] [æ•°æ®ç±»å‹] åç§°() default é»˜è®¤å€¼;
```

ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦å®šä¹‰åœ¨æ³¨è§£ä¸­å®šä¹‰ä¸€ä¸ªåä¸º value çš„å­—ç¬¦ä¸²å±æ€§ï¼Œå…¶é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè®¿é—®çº§åˆ«ä¸ºé»˜è®¤çº§åˆ«ï¼Œé‚£ä¹ˆåº”è¯¥å®šä¹‰å¦‚ä¸‹ï¼š

```
String value() default "";
```

> ğŸ”” æ³¨æ„ï¼š**åœ¨æ³¨è§£ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰å±æ€§æ—¶ï¼Œå±æ€§ååé¢éœ€è¦åŠ  `()`**ã€‚

å®šä¹‰æ³¨è§£å±æ€§æœ‰ä»¥ä¸‹è¦ç‚¹ï¼š

- **æ³¨è§£å±æ€§åªèƒ½ä½¿ç”¨ `public` æˆ–é»˜è®¤è®¿é—®çº§åˆ«ï¼ˆå³ä¸æŒ‡å®šè®¿é—®çº§åˆ«ä¿®é¥°ç¬¦ï¼‰ä¿®é¥°**ã€‚
- è¦æ³¨æ„çš„æ˜¯ï¼Œæ³¨è§£å…ƒç´ çš„ç±»å‹æ˜¯æœ‰é™åˆ¶çš„ï¼Œåªèƒ½ä½¿ç”¨å¦‚ä¸‹çš„ç±»å‹ï¼š
    -   åŸºæœ¬æ•°æ®ç±»å‹
    -   Stringç±»å‹
    -   Classç±»å‹
    -   enumï¼ˆæšä¸¾ï¼‰ç±»å‹
    -   Annotationç±»å‹
    -   ä»¥ä¸Šç±»å‹çš„æ•°ç»„
- **æ³¨è§£å±æ€§å¿…é¡»æœ‰ç¡®å®šçš„å€¼ï¼Œå»ºè®®æŒ‡å®šé»˜è®¤å€¼**ã€‚æ³¨è§£å±æ€§åªèƒ½é€šè¿‡æŒ‡å®šé»˜è®¤å€¼æˆ–ä½¿ç”¨æ³¨è§£æ—¶æŒ‡å®šå±æ€§å€¼ï¼Œç›¸è¾ƒä¹‹ä¸‹ï¼ŒæŒ‡å®šé»˜è®¤å€¼çš„æ–¹å¼æ›´ä¸ºå¯é ã€‚æ³¨è§£å±æ€§å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸å¯ä»¥ä¸º nullã€‚è¿™ä¸ªçº¦æŸä½¿å¾—æ³¨è§£å¤„ç†å™¨å¾ˆéš¾åˆ¤æ–­æ³¨è§£å±æ€§æ˜¯é»˜è®¤å€¼ï¼Œæˆ–æ˜¯ä½¿ç”¨æ³¨è§£æ—¶æ‰€æŒ‡å®šçš„å±æ€§å€¼ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬è®¾ç½®é»˜è®¤å€¼æ—¶ï¼Œä¸€èˆ¬ä¼šå®šä¹‰ä¸€äº›ç‰¹æ®Šçš„å€¼ï¼Œä¾‹å¦‚ç©ºå­—ç¬¦ä¸²æˆ–è€…è´Ÿæ•°ã€‚
- å¦‚æœæ³¨è§£ä¸­åªæœ‰ä¸€ä¸ªå±æ€§å€¼ï¼Œæœ€å¥½å°†å…¶å‘½åä¸º valueã€‚å› ä¸ºï¼ŒæŒ‡å®šå±æ€§åä¸º valueï¼Œåœ¨ä½¿ç”¨æ³¨è§£æ—¶ï¼ŒæŒ‡å®š value çš„å€¼å¯ä»¥ä¸æŒ‡å®šå±æ€§åç§°ã€‚

```java
// è¿™ä¸¤ç§æ–¹å¼æ•ˆæœç›¸åŒ
@RegexValid("^((\\+)?86\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\d{8}$")
@RegexValid(value = "^((\\+)?86\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\d{8}$")
```

æœ‰ä¸¤ç§ç‰¹æ®Šçš„å¿«æ·æ–¹å¼å¯ä»¥ç”¨æ¥ç®€åŒ–æ³¨è§£çš„ä½¿ç”¨ã€‚

1.  å¦‚æœæ³¨è§£ä¸­æ²¡æœ‰å…ƒç´ ï¼Œæˆ–è€…æ‰€æœ‰å…ƒç´ éƒ½ä½¿ç”¨äº†é»˜è®¤å€¼ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨æ³¨è§£æ—¶å°±ä¸éœ€è¦ä½¿ç”¨åœ†æ‹¬å·å’ŒæŒ‡å®šå…ƒç´ äº†ã€‚æ²¡æœ‰ä»»ä½•å…ƒç´ çš„æ³¨è§£ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ ‡è®°æ³¨è§£ï¼ˆmarker annotationï¼‰ï¼Œä¾‹å¦‚Overrideæ³¨è§£ã€‚
2.  å¦å¤–ä¸€ç§å¿«æ·æ–¹å¼æ˜¯å•å€¼æ³¨è§£ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ å…·æœ‰ç‰¹æ®Šçš„åå­—valueï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®šå…¶ä»–å…ƒç´ ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨æ³¨è§£æ—¶å¯ä»¥çœç•¥å…ƒç´ åå’Œç­‰å·ï¼Œç›´æ¥ç»™å‡ºå…ƒç´ çš„å€¼ã€‚

ç¤ºä¾‹ï¼š

äº†è§£äº†æ³¨è§£å±æ€§çš„å®šä¹‰è¦ç‚¹ï¼Œè®©æˆ‘ä»¬æ¥ä¸º `@RegexValid` æ³¨è§£å®šä¹‰å‡ ä¸ªå±æ€§ã€‚

```java
@Documented
@Target({ElementType.FIELD, ElementType.PARAMETER})
@Retention(RetentionPolicy.RUNTIME)
public @interface RegexValid {
    enum Policy {
        // @formatter:off
        EMPTY(null),
        DATE("^(?:(?!0000)[0-9]{4}([-/.]?)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1"
            + "(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|"
            + "(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))$"),
        MAIL("^[A-Za-z0-9](([_\\.\\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\\.\\-]?[a-zA-Z0-9]+)*)\\.([A-Za-z]{2,})$");
        // @formatter:on

        private String policy;

        Policy(String policy) {
            this.policy = policy;
        }

        public String getPolicy() {
            return policy;
        }
    }

    String value() default "";
    Policy policy() default Policy.EMPTY;
}
```

> è¯´æ˜ï¼š
>
> åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ³¨è§£å±æ€§ï¼š`String` ç±»å‹çš„ value å±æ€§å’Œ `Policy` æšä¸¾ç±»å‹çš„ policy å±æ€§ã€‚`Policy` æšä¸¾ä¸­å®šä¹‰äº†å‡ ä¸ªé»˜è®¤çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™æ˜¯ä¸ºäº†ç›´æ¥ä½¿ç”¨è¿™å‡ ä¸ªå¸¸ç”¨è¡¨è¾¾å¼å»æ­£åˆ™æ ¡éªŒã€‚è€ƒè™‘åˆ°ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è‡ªå·±ä¼ å…¥ä¸€äº›è‡ªå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼å»æ ¡éªŒå…¶ä»–åœºæ™¯ï¼Œæ‰€ä»¥å®šä¹‰äº† value å±æ€§ï¼Œå…è®¸ä½¿ç”¨è€…ä¼ å…¥æ­£åˆ™è¡¨è¾¾å¼ã€‚

è‡³æ­¤ï¼Œ`@RegexValid` çš„å£°æ˜å·²ç»ç»“æŸã€‚ä½†æ˜¯ï¼Œç¨‹åºä»ä¸çŸ¥é“å¦‚ä½•å¤„ç† `@RegexValid` è¿™ä¸ªæ³¨è§£ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰æ³¨è§£å¤„ç†å™¨ã€‚

### æ³¨è§£å¤„ç†å™¨

å¦‚æœæ²¡æœ‰ç”¨æ¥è¯»å–æ³¨è§£çš„æ–¹æ³•å’Œå·¥ä½œï¼Œé‚£ä¹ˆæ³¨è§£ä¹Ÿå°±ä¸ä¼šæ¯”æ³¨é‡Šæ›´æœ‰ç”¨å¤„äº†ã€‚ä½¿ç”¨æ³¨è§£çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†å°±æ˜¯åˆ›å»ºäºä½¿ç”¨æ³¨è§£å¤„ç†å™¨ã€‚JDK5 æ‰©å±•äº†åå°„æœºåˆ¶çš„ APIï¼Œä»¥å¸®åŠ©ç¨‹åºå‘˜å¿«é€Ÿçš„æ„é€ è‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨ã€‚

**`java.lang.annotation.Annotation` æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç¨‹åºå¯ä»¥é€šè¿‡åå°„æ¥è·å–æŒ‡å®šç¨‹åºå…ƒç´ çš„æ³¨è§£å¯¹è±¡ï¼Œç„¶åé€šè¿‡æ³¨è§£å¯¹è±¡æ¥è·å–æ³¨è§£é‡Œé¢çš„å…ƒæ•°æ®**ã€‚

`Annotation` æ¥å£æºç å¦‚ä¸‹ï¼š

```java
public interface Annotation {
    boolean equals(Object obj);

    int hashCode();

    String toString();

    Class<? extends Annotation> annotationType();
}
```

é™¤æ­¤ä¹‹å¤–ï¼ŒJava ä¸­æ”¯æŒ**æ³¨è§£å¤„ç†å™¨æ¥å£ `java.lang.reflect.AnnotatedElement`** ï¼Œè¯¥æ¥å£ä»£è¡¨ç¨‹åºä¸­å¯ä»¥æ¥å—æ³¨è§£çš„ç¨‹åºå…ƒç´ ï¼Œè¯¥æ¥å£ä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªå®ç°ç±»ï¼š

- `Class` ï¼šç±»å®šä¹‰
- `Constructor` ï¼šæ„é€ å™¨å®šä¹‰
- `Field` ï¼šç´¯çš„æˆå‘˜å˜é‡å®šä¹‰
- `Method` ï¼šç±»çš„æ–¹æ³•å®šä¹‰
- `Package` ï¼š ç±»çš„åŒ…å®šä¹‰

`java.lang.reflect` åŒ…ä¸‹ä¸»è¦åŒ…å«ä¸€äº›å®ç°åå°„åŠŸèƒ½çš„å·¥å…·ç±»ã€‚å®é™…ä¸Šï¼Œ`java.lang.reflect` åŒ…æ‰€æœ‰æä¾›çš„åå°„ API æ‰©å……äº†è¯»å–è¿è¡Œæ—¶æ³¨è§£ä¿¡æ¯çš„èƒ½åŠ›ã€‚å½“ä¸€ä¸ªæ³¨è§£ç±»å‹è¢«å®šä¹‰ä¸ºè¿è¡Œæ—¶çš„æ³¨è§£åï¼Œè¯¥æ³¨è§£æ‰èƒ½æ˜¯è¿è¡Œæ—¶å¯è§ï¼Œå½“ class æ–‡ä»¶è¢«è£…è½½æ—¶è¢«ä¿å­˜åœ¨ class æ–‡ä»¶ä¸­çš„æ³¨è§£æ‰ä¼šè¢«è™šæ‹Ÿæœºè¯»å–ã€‚
`AnnotatedElement` æ¥å£æ˜¯æ‰€æœ‰ç¨‹åºå…ƒç´ ï¼ˆClassã€Method å’Œ Constructorï¼‰çš„çˆ¶æ¥å£ï¼Œæ‰€ä»¥ç¨‹åºé€šè¿‡åå°„è·å–äº†æŸä¸ªç±»çš„`AnnotatedElement` å¯¹è±¡ä¹‹åï¼Œç¨‹åºå°±å¯ä»¥è°ƒç”¨è¯¥å¯¹è±¡çš„å¦‚ä¸‹å››ä¸ªä¸ªæ–¹æ³•æ¥è®¿é—®æ³¨è§£ä¿¡æ¯ï¼š

- `getAnnotation` - è¿”å›è¯¥ç¨‹åºå…ƒç´ ä¸Šå­˜åœ¨çš„ã€æŒ‡å®šç±»å‹çš„æ³¨è§£ï¼Œå¦‚æœè¯¥ç±»å‹æ³¨è§£ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› nullã€‚
- `getAnnotations` - è¿”å›è¯¥ç¨‹åºå…ƒç´ ä¸Šå­˜åœ¨çš„æ‰€æœ‰æ³¨è§£ã€‚
- `isAnnotationPresent` - åˆ¤æ–­è¯¥ç¨‹åºå…ƒç´ ä¸Šæ˜¯å¦åŒ…å«æŒ‡å®šç±»å‹çš„æ³¨è§£ï¼Œå­˜åœ¨åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚
- `getDeclaredAnnotations` - è¿”å›ç›´æ¥å­˜åœ¨äºæ­¤å…ƒç´ ä¸Šçš„æ‰€æœ‰æ³¨é‡Šã€‚ä¸æ­¤æ¥å£ä¸­çš„å…¶ä»–æ–¹æ³•ä¸åŒï¼Œè¯¥æ–¹æ³•å°†å¿½ç•¥ç»§æ‰¿çš„æ³¨é‡Šã€‚ï¼ˆå¦‚æœæ²¡æœ‰æ³¨é‡Šç›´æ¥å­˜åœ¨äºæ­¤å…ƒç´ ä¸Šï¼Œåˆ™è¿”å›é•¿åº¦ä¸ºé›¶çš„ä¸€ä¸ªæ•°ç»„ã€‚ï¼‰è¯¥æ–¹æ³•çš„è°ƒç”¨è€…å¯ä»¥éšæ„ä¿®æ”¹è¿”å›çš„æ•°ç»„ï¼›è¿™ä¸ä¼šå¯¹å…¶ä»–è°ƒç”¨è€…è¿”å›çš„æ•°ç»„äº§ç”Ÿä»»ä½•å½±å“ã€‚

äº†è§£äº†ä»¥ä¸Šå†…å®¹ï¼Œè®©æˆ‘ä»¬æ¥å®ç° `@RegexValid` çš„æ³¨è§£å¤„ç†å™¨ï¼š

```java
import java.lang.reflect.Field;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class RegexValidUtil {
    public static boolean check(Object obj) throws Exception {
        boolean result = true;
        StringBuilder sb = new StringBuilder();
        Field[] fields = obj.getClass().getDeclaredFields();
        for (Field field : fields) {
            // åˆ¤æ–­æˆå‘˜æ˜¯å¦è¢« @RegexValid æ³¨è§£æ‰€ä¿®é¥°
            if (field.isAnnotationPresent(RegexValid.class)) {
                RegexValid valid = field.getAnnotation(RegexValid.class);

                // å¦‚æœ value ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè¯´æ˜æ²¡æœ‰æ³¨å…¥è‡ªå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ”¹ç”¨ policy å±æ€§
                String value = valid.value();
                if ("".equals(value)) {
                    RegexValid.Policy policy = valid.policy();
                    value = policy.getPolicy();
                }

                // é€šè¿‡è®¾ç½® setAccessible(true) æ¥è®¿é—®ç§æœ‰æˆå‘˜
                field.setAccessible(true);
                Object fieldObj = null;
                try {
                    fieldObj = field.get(obj);
                } catch (IllegalAccessException e) {
                    e.printStackTrace();
                }
                if (fieldObj == null) {
                    sb.append("\n")
                        .append(String.format("%s ç±»ä¸­çš„ %s å­—æ®µä¸èƒ½ä¸ºç©ºï¼", obj.getClass().getName(), field.getName()));
                    result = false;
                } else {
                    if (fieldObj instanceof String) {
                        String text = (String) fieldObj;
                        Pattern p = Pattern.compile(value);
                        Matcher m = p.matcher(text);
                        result = m.matches();
                        if (!result) {
                            sb.append("\n").append(String.format("%s ä¸æ˜¯åˆæ³•çš„ %s ï¼", text, field.getName()));
                        }
                    } else {
                        sb.append("\n").append(
                            String.format("%s ç±»ä¸­çš„ %s å­—æ®µä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸èƒ½ä½¿ç”¨æ­¤æ³¨è§£æ ¡éªŒï¼", obj.getClass().getName(), field.getName()));
                        result = false;
                    }
                }
            }
        }

        if (sb.length() > 0) {
            throw new Exception(sb.toString());
        }
        return result;
    }
}
```

> è¯´æ˜ï¼š
>
> ä»¥ä¸Šç¤ºä¾‹ä¸­çš„æ³¨è§£å¤„ç†å™¨ï¼Œæ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š
>
> 1. é€šè¿‡ getDeclaredFields åå°„æ–¹æ³•è·å–ä¼ å…¥å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜ã€‚
> 2. éå†æˆå‘˜ï¼Œä½¿ç”¨ isAnnotationPresent åˆ¤æ–­æˆå‘˜æ˜¯å¦è¢«æŒ‡å®šæ³¨è§£æ‰€ä¿®é¥°ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥è·³è¿‡ã€‚
> 3. å¦‚æœæˆå‘˜è¢«æ³¨è§£æ‰€ä¿®é¥°ï¼Œé€šè¿‡ `RegexValid valid = field.getAnnotation(RegexValid.class);` è¿™æ ·çš„å½¢å¼è·å–ï¼Œæ³¨è§£å®ä¾‹åŒ–å¯¹è±¡ï¼Œç„¶åï¼Œå°±å¯ä»¥ä½¿ç”¨ `valid.value()` æˆ– `valid.policy()` è¿™æ ·çš„å½¢å¼è·å–æ³¨è§£ä¸­è®¾å®šçš„å±æ€§å€¼ã€‚
> 4. æ ¹æ®å±æ€§å€¼ï¼Œè¿›è¡Œé€»è¾‘å¤„ç†ã€‚

### ä½¿ç”¨æ³¨è§£

å®Œæˆäº†ä»¥ä¸Šå·¥ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```java
public class RegexValidDemo {
    static class User {
        private String name;
        @RegexValid(policy = RegexValid.Policy.DATE)
        private String date;
        @RegexValid(policy = RegexValid.Policy.MAIL)
        private String mail;
        @RegexValid("^((\\+)?86\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\d{8}$")
        private String phone;

        public User(String name, String date, String mail, String phone) {
            this.name = name;
            this.date = date;
            this.mail = mail;
            this.phone = phone;
        }

        @Override
        public String toString() {
            return "User{" + "name='" + name + '\'' + ", date='" + date + '\'' + ", mail='" + mail + '\'' + ", phone='"
                + phone + '\'' + '}';
        }
    }

    static void printDate(@RegexValid(policy = RegexValid.Policy.DATE) String date){
        System.out.println(date);
    }

    public static void main(String[] args) throws Exception {
        User user = new User("Tom", "1990-01-31", "xxx@163.com", "18612341234");
        User user2 = new User("Jack", "2019-02-29", "sadhgs", "183xxxxxxxx");
        if (RegexValidUtil.check(user)) {
            System.out.println(user + "æ­£åˆ™æ ¡éªŒé€šè¿‡");
        }
        if (RegexValidUtil.check(user2)) {
            System.out.println(user2 + "æ­£åˆ™æ ¡éªŒé€šè¿‡");
        }
    }
}
```

## å…ƒæ³¨è§£

JDK ä¸­è™½ç„¶å†…ç½®äº†å‡ ä¸ªæ³¨è§£ï¼Œä½†è¿™è¿œè¿œä¸èƒ½æ»¡è¶³å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„åƒå˜ä¸‡åŒ–çš„éœ€æ±‚ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰æ³¨è§£ï¼Œè€Œè¿™å°±éœ€è¦ç”¨åˆ°å…ƒæ³¨è§£ã€‚

**å…ƒæ³¨è§£çš„ä½œç”¨å°±æ˜¯ç”¨äºå®šä¹‰å…¶å®ƒçš„æ³¨è§£**ã€‚

Java ä¸­æä¾›äº†ä»¥ä¸‹å…ƒæ³¨è§£ç±»å‹ï¼š

- `@Retention`
- `@Target`
- `@Documented`
- `@Inherited`ï¼ˆJDK8 å¼•å…¥ï¼‰
- `@Repeatable`ï¼ˆJDK8 å¼•å…¥ï¼‰

è¿™äº›ç±»å‹å’Œå®ƒä»¬æ‰€æ”¯æŒçš„ç±»åœ¨ `java.lang.annotation` åŒ…ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œåœ¨å®šä¹‰æ³¨è§£æ—¶ä½¿ç”¨ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹æ¯ä¸ªå…ƒæ³¨è§£çš„ä½œç”¨å’Œç›¸åº”åˆ†å‚æ•°çš„ä½¿ç”¨è¯´æ˜ã€‚

### @Documented

@Documentedè¡¨ç¤ºæ— è®ºä½•æ—¶ä½¿ç”¨æŒ‡å®šçš„æ³¨è§£ï¼Œéƒ½åº”ä½¿ç”¨ Javadocï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ³¨é‡Šä¸åŒ…å«åœ¨ Javadoc ä¸­ï¼‰ã€‚

å¦‚æœåœ¨å®šä¹‰æ³¨è§£æ—¶ä½¿ç”¨äº†Documentedå…ƒæ³¨è§£ï¼Œé‚£ä¹ˆå½“ä½¿ç”¨javadocå·¥å…·ç”ŸæˆJavaDocæ–‡æ¡£æ—¶ï¼Œæ–‡æ¡£ä¸­ä¼šåŒ…å«è¯¥æ³¨è§£çš„ä½¿ç”¨ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š

```
import java.lang.annotation.Documented;

@Documented
public @interface BugReport {
    int severity() default 0;
    String msg();
}
```

åœ¨Testç±»ä¸­å¯¹ä¸¤ä¸ªæ–¹æ³•ä½¿ç”¨äº†BugReportæ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
public class Test {
    @BugReport(msg = "warn")
    void test1() {}

    @BugReport(severity = 1, msg = "error")
    void test2() {}

}
```

å½“ä½¿ç”¨javadocå·¥å…·ç”ŸæˆTestç±»çš„APIæ–‡æ¡£æ—¶ï¼Œä¼šä¿ç•™@BugReportæ³¨è§£çš„ä¿¡æ¯ã€‚

### @Retention

Retentionå…ƒæ³¨è§£ç”¨äºæŒ‡å®šæ³¨è§£çš„ä¿ç•™çº§åˆ«ã€‚

`@Retention` æºç ï¼š

```java
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.ANNOTATION_TYPE)
public @interface Retention {
    RetentionPolicy value();
}
```

`RetentionPolicy` æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå®ƒå®šä¹‰äº†è¢« `@Retention` ä¿®é¥°çš„æ³¨è§£æ‰€æ”¯æŒçš„ä¿ç•™çº§åˆ«ï¼š

-   `RetentionPolicy.SOURCE` ï¼šæ³¨è§£ä»…ä¿ç•™åœ¨æºä»£ç ä¸­ï¼Œåœ¨ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨å°†ä¸¢å¼ƒæ³¨è§£ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸ªæ³¨è§£åœ¨å®šä¹‰æ—¶ä½¿ç”¨äº†SOURCEä¿ç•™ç­–ç•¥ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘æ—¶ï¼Œè¯¥æ³¨è§£çš„æ‰€æœ‰ä½¿ç”¨ä¿¡æ¯éƒ½ä¼šè¢«ç¼–è¯‘å™¨ä¸¢å¼ƒã€‚è¿™ç±»å‹çš„æ³¨è§£é€‚ç”¨äºä»£ç åˆ†æå·¥å…·ã€‚
-   `RetentionPolicy.CLASS` ï¼šæ³¨è§£å°†ä¿ç•™åœ¨.classæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯ä¼šè¢«JVMå¿½ç•¥ã€‚è¿™ç±»å‹çš„æ³¨è§£é€‚ç”¨äºå¯¹å­—èŠ‚ç è¿›è¡Œæ“ä½œçš„å·¥å…·ã€‚
-   `RetentionPolicy.RUNTIME` ï¼šæ³¨è§£å°†ç”±ç¼–è¯‘å™¨è®°å½•åœ¨.classæ–‡ä»¶ä¸­ï¼Œå¹¶åœ¨è¿è¡ŒæœŸé—´ä¿ç•™ï¼Œå› æ­¤å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è®¿é—®åˆ°æ³¨è§£çš„ä¿¡æ¯ã€‚

ä¾‹å¦‚ï¼š

```
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;

@Retention(RetentionPolicy.RUNTIME)
public @interface BugReport {
    int severity() default 0;
    String msg();
}
```

å¦‚æœåœ¨å®šä¹‰æ³¨è§£æ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨@Retentionè¯´æ˜æ³¨è§£çš„ä¿ç•™çº§åˆ«ï¼Œé‚£ä¹ˆä¿ç•™ç­–ç•¥é»˜è®¤ä¸ºRetentionPolicy.CLASSã€‚

`@Retention` ç¤ºä¾‹ï¼š

```java
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Column {
    public String name() default "fieldName";
    public String setFuncName() default "setField";
    public String getFuncName() default "getField";
    public boolean defaultDBValue() default false;
}
```

### @Target

`@Target`æŒ‡å®šæ³¨è§£å¯ä»¥ä¿®é¥°çš„å…ƒç´ ç±»å‹ã€‚

`@Target` æºç ï¼š

```java
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.ANNOTATION_TYPE)
public @interface Target {
    ElementType[] value();
}
```

`ElementType` æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå®ƒå®šä¹‰äº†è¢« `@Target` ä¿®é¥°çš„æ³¨è§£å¯ä»¥åº”ç”¨çš„èŒƒå›´ï¼š

- `ElementType.ANNOTATION_TYPE` - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºæ³¨è§£ç±»å‹ã€‚
- `ElementType.CONSTRUCTOR` - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºæ„é€ å‡½æ•°ã€‚
- `ElementType.FIELD` - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºå­—æ®µæˆ–å±æ€§ã€‚
- `ElementType.LOCAL_VARIABLE` - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºå±€éƒ¨å˜é‡ã€‚
- `ElementType.METHOD` - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºæ–¹æ³•ã€‚
- `ElementType.PACKAGE` - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºåŒ…å£°æ˜ã€‚
- `ElementType.PARAMETER` - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºæ–¹æ³•çš„å‚æ•°ã€‚
- `ElementType.TYPE` - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºç±»çš„ä»»ä½•å…ƒç´ ã€‚

ä¾‹å¦‚ï¼š

```
import java.lang.annotation.ElementType;
import java.lang.annotation.Target;

@Target(ElementType.TYPE)
public @interface BugReport {
    int severity() default 0;
    String msg();
}
```

æŒ‡å®šBugReportæ³¨è§£åªèƒ½ç”¨äºç±»ã€æ¥å£æˆ–æšä¸¾çš„å£°æ˜ä¸­ã€‚

### @Inherited

@Inheritedè¡¨ç¤ºæ³¨è§£ç±»å‹å¯ä»¥è¢«ç»§æ‰¿ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸æ˜¯è¿™æ ·ï¼‰ã€‚

è¡¨ç¤ºè‡ªåŠ¨ç»§æ‰¿æ³¨è§£ç±»å‹ã€‚ å¦‚æœæ³¨è§£ç±»å‹å£°æ˜ä¸­å­˜åœ¨ `@Inherited` å…ƒæ³¨è§£ï¼Œåˆ™æ³¨è§£æ‰€ä¿®é¥°ç±»çš„æ‰€æœ‰å­ç±»éƒ½å°†ä¼šç»§æ‰¿æ­¤æ³¨è§£ã€‚

> ğŸ”” æ³¨æ„ï¼š`@Inherited` æ³¨è§£ç±»å‹æ˜¯è¢«æ ‡æ³¨è¿‡çš„ç±»çš„å­ç±»æ‰€ç»§æ‰¿ã€‚ç±»å¹¶ä¸ä»å®ƒæ‰€å®ç°çš„æ¥å£ç»§æ‰¿æ³¨è§£ï¼Œæ–¹æ³•å¹¶ä¸ä»å®ƒæ‰€è¦†å†™çš„æ–¹æ³•ç»§æ‰¿æ³¨è§£ã€‚
>
> æ­¤å¤–ï¼Œå½“ `@Inherited` ç±»å‹æ ‡æ³¨çš„æ³¨è§£çš„ `@Retention` æ˜¯ `RetentionPolicy.RUNTIME`ï¼Œåˆ™åå°„ API å¢å¼ºäº†è¿™ç§ç»§æ‰¿æ€§ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ `java.lang.reflect` å»æŸ¥è¯¢ä¸€ä¸ª `@Inherited` ç±»å‹çš„æ³¨è§£æ—¶ï¼Œåå°„ä»£ç æ£€æŸ¥å°†å±•å¼€å·¥ä½œï¼šæ£€æŸ¥ç±»å’Œå…¶çˆ¶ç±»ï¼Œç›´åˆ°å‘ç°æŒ‡å®šçš„æ³¨è§£ç±»å‹è¢«å‘ç°ï¼Œæˆ–è€…åˆ°è¾¾ç±»ç»§æ‰¿ç»“æ„çš„é¡¶å±‚ã€‚

```java
@Inherited
public @interface Greeting {
    public enum FontColor{ BULE,RED,GREEN};
    String name();
    FontColor fontColor() default FontColor.GREEN;
}
```

å…è®¸å­ç±»ç»§æ‰¿çˆ¶ç±»ä¸­çš„æ³¨è§£ã€‚å¦‚æœæŸä¸ªæ³¨è§£åœ¨å®šä¹‰çš„æ—¶å€™ä½¿ç”¨äº†@Inheritedï¼Œé‚£ä¹ˆå½“ä½¿ç”¨è¿™ä¸ªæ³¨è§£ä¿®é¥°æŸä¸ªç±»æ—¶ï¼Œè¿™ä¸ªç±»çš„å­ç±»ä¹Ÿä¼šè¢«è¿™ä¸ªæ³¨è§£æ‰€ä¿®é¥°ã€‚

è¦æ³¨æ„çš„æ˜¯ï¼ŒInheritedå…ƒæ³¨è§£åªæœ‰åœ¨ç”¨äºå¯¹ç±»çš„æ³¨è§£ä¸Šæ‰æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­çš„Inheritedæ³¨è§£æ²¡æœ‰ä»»ä½•æ•ˆæœã€‚

```
import java.lang.annotation.ElementType;
import java.lang.annotation.Inherited;
import java.lang.annotation.Target;

@Target(ElementType.TYPE)
@Inherited
public @interface BugReport {
    int severity() default 0;
    String msg();
}
```

æ­¤å¤–ï¼Œè¿˜è¦æ³¨æ„çš„æ˜¯ï¼ŒInheritedå…ƒæ³¨è§£åªä¼šå¯¼è‡´ä»è¶…ç±»ç»§æ‰¿æ³¨è§£ï¼Œåœ¨å®ç°çš„æ¥å£ä¸Šçš„æ³¨è§£æ²¡æœ‰ä»»ä½•æ•ˆæœã€‚

### @Repeatable

Repeatableå…ƒæ³¨è§£å…è®¸åœ¨åŒä¸€ä¸ªåœ°æ–¹å¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ªæ³¨è§£ã€‚

å£°æ˜å¯é‡å¤çš„æ³¨è§£ï¼Œéœ€è¦ä¸¤ä¸ªæ­¥éª¤ã€‚

1.  å£°æ˜å¯é‡å¤çš„æ³¨è§£ç±»å‹ã€‚
2.  å£°æ˜åŒ…å«çš„æ³¨è§£ç±»å‹ã€‚

æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚

ç¬¬ä¸€æ­¥ï¼Œå£°æ˜å¯é‡å¤çš„æ³¨è§£ç±»å‹Listenerï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
import java.lang.annotation.Repeatable;

@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Repeatable(Listeners.class)
public @interface Listener {
    String value();
}
```

Listeneræ³¨è§£ä½¿ç”¨@Repeatable(Listeners.class)å…ƒæ³¨è§£è¿›è¡Œä¿®é¥°ï¼ŒListenersæ˜¯å­˜æ”¾Listeneræ³¨è§£çš„å®¹å™¨ã€‚Listenersä¹Ÿæ˜¯ä¸€ä¸ªæ³¨è§£ï¼Œå…¶å…ƒç´ çš„å€¼å°±æ˜¯Listeneræ³¨è§£ã€‚

ç¬¬äºŒæ­¥ï¼Œå£°æ˜åŒ…å«çš„æ³¨è§£ç±»å‹ï¼Œå³Listenersæ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Listeners {
    Listener[] value();
}
```

æ¥ä¸‹æ¥å°±å¯ä»¥åœ¨ç±»æˆ–æ¥å£ä¸Šé‡å¤åº”ç”¨Listeneræ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
@Listener("ActionListener")
@Listener("WindowListener")
public class RepeatableAnnotation {
}
```

## æ³¨è§£ä¸åå°„

ä½ æ˜¯å¦æœ‰ç–‘é—®ï¼Œè‡ªå®šä¹‰çš„æ³¨è§£åˆ°åº•æœ‰ä»€ä¹ˆç”¨ï¼Ÿå¦‚æœä½ åªæ˜¯å®šä¹‰äº†æ³¨è§£ï¼Œç”¨æ³¨è§£å»åšæ ‡è®°ï¼Œé‚£ç¡®å®æ²¡ä»€ä¹ˆç”¨ã€‚è¦æƒ³è®©æ³¨è§£çœŸæ­£èµ·ä½œç”¨ï¼Œè¿˜éœ€è¦ç¼–å†™ç¨‹åºå¯¹æ ‡è®°åçš„æ³¨è§£è¿›è¡Œè§£æï¼Œæ ¹æ®æ³¨è§£çš„å«ä¹‰åšå‡ºç›¸åº”çš„åŠ¨ä½œã€‚

è¦è§£ææ³¨è§£ï¼Œè‡ªç„¶è¦å…ˆå¾—åˆ°æ³¨è§£çš„ä¿¡æ¯ï¼Œåœ¨åå°„APIä¸­ï¼Œå®šä¹‰äº†AnnotatedElementæ¥å£ï¼Œåœ¨è¯¥æ¥å£ä¸­ç»™å‡ºäº†å¾—åˆ°æ³¨è§£çš„æ–¹æ³•ã€‚Classã€Constructorã€Fieldã€Methodç­‰å¯ä»¥ç”¨æ³¨è§£æ ‡è®°çš„ç¨‹åºå…ƒç´ éƒ½å®ç°äº†AnnotatedElementæ¥å£ï¼Œä¾¿äºè·å–å…¶ä¸Šå­˜åœ¨çš„æ³¨è§£ã€‚

AnnotatedElementæ¥å£ä¸­çš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š

-   `default boolean isAnnotationPresent(Class<? extends Annotation>annotationClass)`ï¼šåˆ¤æ–­æ­¤å…ƒç´ ä¸Šæ˜¯å¦å­˜åœ¨æŒ‡å®šç±»å‹çš„æ³¨è§£ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯äº†æ–¹ä¾¿è®¿é—®æ ‡è®°æ³¨è§£è€Œç»™å‡ºçš„ã€‚å½“è¿™ä¸ªæ–¹æ³•è¿”å›trueæ—¶ï¼Œç›¸å½“äºï¼šgetAnnotationï¼ˆannotationClassï¼‰ ï¼= nullã€‚
-   `<T extends Annotation> T getAnnotation(Class<T> annotationClass)`ï¼šå¦‚æœæ­¤å…ƒç´ ä¸Šå­˜åœ¨æŒ‡å®šç±»å‹çš„æ³¨è§£ï¼Œåˆ™è¿”å›å®ƒï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›nullã€‚
-   `Annotation[] getAnnotations()`ï¼šè¿”å›æ­¤å…ƒç´ ä¸Šå­˜åœ¨çš„æ‰€æœ‰æ³¨è§£ï¼ŒåŒ…æ‹¬ç»§æ‰¿å¾—åˆ°çš„æ³¨è§£ã€‚å¦‚æœæ²¡æœ‰æ³¨è§£ï¼Œåˆ™è¿”å›é•¿åº¦ä¸º0çš„æ•°ç»„ã€‚
-   `default <T extends Annotation> T[] getAnnotationsByType(Class<T>annotationClass)`ï¼šè¿™æ˜¯Java 8æ–°å¢çš„æ–¹æ³•ã€‚ç”¨äºè·å¾—ä¸è¯¥ç¨‹åºå…ƒç´ å…³è”çš„æ³¨è§£ã€‚è¿™ä¸ªæ–¹æ³•ä¸getAnnotationçš„åŒºåˆ«æ˜¯ï¼Œå®ƒå¯ä»¥è¿”å›é‡å¤çš„æ³¨è§£ã€‚å¦‚æœæ²¡æœ‰ä¸æ­¤å…ƒç´ å…³è”çš„æ³¨è§£ï¼Œåˆ™è¿”å›é•¿åº¦ä¸º0çš„æ•°ç»„ã€‚
-   `default <T extends Annotation> T getDeclaredAnnotation(Class<T>annotationClass)`ï¼šå¦‚æœåœ¨æ­¤å…ƒç´ ä¸Šç›´æ¥å­˜åœ¨æŒ‡å®šç±»å‹çš„æ³¨è§£ï¼Œåˆ™è¿”å›å®ƒï¼Œå¦åˆ™ï¼Œè¿”å›nullã€‚è¿™ä¸ªæ–¹æ³•å¿½ç•¥ç»§æ‰¿çš„æ³¨è§£ã€‚
-   `default <T extends Annotation> T[]getDeclaredAnnotationsByType(Class<T>annotationClass)`ï¼šè¿™æ˜¯Java 8æ–°å¢çš„æ–¹æ³•ã€‚å¦‚æœæŒ‡å®šç±»å‹çš„æ³¨è§£ç›´æ¥å­˜åœ¨æˆ–é—´æ¥å­˜åœ¨ï¼Œåˆ™è¿”å›æ­¤å…ƒç´ çš„æ³¨è§£ã€‚è¿™ä¸ªæ–¹æ³•å¿½ç•¥ç»§æ‰¿çš„æ³¨è§£ã€‚è¿™ä¸ªæ–¹æ³•ä¸`getDeclaredAnnotation`çš„åŒºåˆ«æ˜¯ï¼Œå®ƒå¯ä»¥è¿”å›é‡å¤çš„æ³¨è§£ã€‚å¦‚æœåœ¨æ­¤å…ƒç´ ä¸Šæ²¡æœ‰ç›´æ¥æˆ–é—´æ¥å­˜åœ¨çš„æŒ‡å®šæ³¨è§£ï¼Œåˆ™è¿”å›é•¿åº¦ä¸º0çš„æ•°ç»„ã€‚
-   `Annotation[] getDeclaredAnnotations()`ï¼šè¿”å›ç›´æ¥å­˜åœ¨äºæ­¤å…ƒç´ ä¸Šçš„æ‰€æœ‰æ³¨è§£ã€‚è¿™ä¸ªæ–¹æ³•å¿½ç•¥ç»§æ‰¿çš„æ³¨è§£ã€‚å¦‚æœåœ¨æ­¤å…ƒç´ ä¸Šæ²¡æœ‰ç›´æ¥å­˜åœ¨çš„æ³¨è§£ï¼Œåˆ™è¿”å›é•¿åº¦ä¸º0çš„æ•°ç»„

ä¸‹é¢æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ªç±»ä¸­ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ï¼Œç„¶åé€šè¿‡åå°„æ¥å¾—åˆ°æ³¨è§£çš„ä¿¡æ¯ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ç”¨åˆ°äº†ä¸¤ä¸ªæ³¨è§£ï¼Œä¸€ä¸ªæ˜¯@Listenerï¼Œç›´æ¥ç”¨ä¸Šä¸€èŠ‚çš„ä»£ç ï¼Œå¦ä¸€ä¸ªæ˜¯@BugReportã€‚@BugReporæ³¨è§£çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

```
import java.lang.annotation.Target;
import java.lang.annotation.Retention;
import java.lang.annotation.ElementType;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Inherited;

// æ³¨è§£å¯ç”¨äºç±»ã€å­—æ®µå’Œæ–¹æ³•
@Target({ElementType.TYPE, ElementType.FIELD, ElementType.METHOD})
// æ³¨è§£åœ¨è¿è¡ŒæœŸé—´å¯ç”¨ï¼Œå› æ­¤å¯ä»¥é€šè¿‡åå°„APIå¾—åˆ°æ³¨è§£ä¿¡æ¯
@Retention(RetentionPolicy.RUNTIME)
// æ³¨è§£å¯ç»§æ‰¿
@Inherited
public @interface BugReport{
    int severity() default 0;
    String msg();
}
```

æ¥ä¸‹æ¥åœ¨ç¨‹åºå…ƒç´ ä¸Šåº”ç”¨@Listenerå’Œ@BugReportæ³¨è§£ï¼Œä½¿ç”¨åå°„APIå¾—åˆ°æ³¨è§£ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```
import java.lang.annotation.Annotation;
import java.lang.reflect.Field;
import java.lang.reflect.Method;

@BugReport(msg = "æŠ¥å‘ŠåŸºç±»Bug")
class Base {
}

@Listener("ActionListener")
@Listener("WindowListener")
class Derived extends Base {
    @BugReport(severity = 1, msg = "nameå­—æ®µçš„Bug")
    private String name;

    @BugReport(severity = 2, msg = "actionæ–¹æ³•çš„Bug")
    public void action() {
    }
}

public class ReflectAnnotation {
    public static void main(String[] args) throws Exception {
        Class<Derived> clz = Derived.class;
        System.out.println("---------Derivedç±»ä¸Šçš„æ³¨è§£---------");
        // å¾—åˆ°Derivedç±»ä¸Šçš„æ‰€æœ‰æ³¨è§£ï¼ŒåŒ…æ‹¬ç»§æ‰¿çš„æ³¨è§£
        Annotation[] annotations = clz.getAnnotations();
        for (Annotation anno : annotations) {
            // å¾—åˆ°æ³¨è§£ç±»å‹
            Class annoClz = anno.annotationType();
            System.out.println("æ³¨è§£çš„ç±»å‹" + annoClz);

            if (BugReport.class.equals(annoClz)) {
                BugReport br = (BugReport) anno;
                // è·å–æ³¨è§£ä¸­çš„å…ƒç´ å€¼ï¼Œå°±åƒè°ƒç”¨æ™®é€šæ–¹æ³•ä¸€æ ·
                System.out.printf("---å…ƒç´ ï¼šseverity=%d, msg=%s%n", br.severity(), br.msg());
            }
            // å¯¹äºé‡å¤æ³¨è§£ï¼Œå¾—åˆ°çš„æ˜¯æ³¨è§£çš„å®¹å™¨ï¼Œå³ Listenersæ³¨è§£
            else if (Listeners.class.equals(annoClz)) {
                Listeners listeners = (Listeners) anno;
                Listener[] listener = listeners.value();
                for (Listener lis : listener) {
                    System.out.printf("----å…ƒç´ ï¼švalue=%s%n",
                            lis.value());
                }
            }
        }
        System.out.println();
        System.out.println("---------Derivedç±»å­—æ®µä¸Šçš„æ³¨è§£---------");
        // å¾—åˆ° Derivedç±»çš„nameå­—æ®µ
        Field field = clz.getDeclaredField("name");
        // åˆ¤æ–­nameå­—æ®µä¸Šæ˜¯å¦æœ‰BugReportæ³¨è§£
        if (field.isAnnotationPresent(BugReport.class)) {
            // å¾—åˆ°nameå­—æ®µä¸Šæ˜¯å¦æœ‰BugReportæ³¨è§£
            BugReport bugAnno = field.getDeclaredAnnotation(BugReport.class);
            System.out.println("æ³¨è§£çš„ç±»å‹" + bugAnno.annotationType());
            System.out.printf("----å…ƒç´ :severity=%d, msg=%s%n", bugAnno.severity(), bugAnno.msg());
        }

        System.out.println();
        System.out.println("---------Derivedç±»æ–¹æ³•ä¸Šçš„æ³¨è§£---------");

        Method mth = clz.getMethod("action");
        // å¾—åˆ°actionæ–¹æ³•ä¸Šçš„ BugReportæ³¨è§£
        BugReport bugAnno =
                mth.getAnnotation(BugReport.class);
        if (bugAnno != null) {
            System.out.println("æ³¨è§£çš„ç±»å‹" + bugAnno.annotationType());
            System.out.printf("----å…ƒç´ ï¼šseverity=%d, msg=%s%n", bugAnno.severity(), bugAnno.msg());
        }
    }
}
```

åœ¨ä»£ç ä¸­ç»™å‡ºäº†è¯¦ç»†çš„æ³¨é‡Šï¼Œè¯»è€…å¯ä»¥å‚ç…§å‰é¢è®²è¿°çš„è·å–æ³¨è§£ä¿¡æ¯çš„ç›¸å…³æ–¹æ³•ï¼Œå¹¶ç»“åˆä»£ç æ¥å­¦ä¹ ã€‚

è¿è¡Œç»“æœï¼š

```
---------Derivedç±»ä¸Šçš„æ³¨è§£---------
æ³¨è§£çš„ç±»å‹interface org.example.BugReport
---å…ƒç´ ï¼šseverity=0, msg=æŠ¥å‘ŠåŸºç±»Bug
æ³¨è§£çš„ç±»å‹interface org.example.Listeners
----å…ƒç´ ï¼švalue=ActionListener
----å…ƒç´ ï¼švalue=WindowListener

---------Derivedç±»å­—æ®µä¸Šçš„æ³¨è§£---------
æ³¨è§£çš„ç±»å‹interface org.example.BugReport
----å…ƒç´ :severity=1, msg=nameå­—æ®µçš„Bug

---------Derivedç±»æ–¹æ³•ä¸Šçš„æ³¨è§£---------
æ³¨è§£çš„ç±»å‹interface org.example.BugReport
----å…ƒç´ ï¼šseverity=2, msg=actionæ–¹æ³•çš„Bug
```
